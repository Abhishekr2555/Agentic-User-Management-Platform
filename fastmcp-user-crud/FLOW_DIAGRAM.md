# Long-Running Tools Flow Diagram

## How It Works: Agent â†’ MCP Tool â†’ Result

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         USER REQUEST                             â”‚
â”‚  "Create 5 users with batch_create_users_async"                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    PYDANTIC AI AGENT                             â”‚
â”‚  - Receives user request                                         â”‚
â”‚  - Determines which tool to use                                  â”‚
â”‚  - Prepares tool arguments                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Invokes tool via MCP
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      MCP SERVER (SSE)                            â”‚
â”‚  URL: http://localhost:8001/sse                                  â”‚
â”‚                                                                   â”‚
â”‚  Available Tools:                                                â”‚
â”‚  âœ“ create_user()                                                 â”‚
â”‚  âœ“ batch_create_users_async() â† SELECTED                        â”‚
â”‚  âœ“ read_user()                                                   â”‚
â”‚  âœ“ update_user()                                                 â”‚
â”‚  âœ“ delete_user()                                                 â”‚
â”‚  âœ“ list_users()                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Executes tool
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LONG-RUNNING TOOL EXECUTION                         â”‚
â”‚                                                                   â”‚
â”‚  @mcp.tool()                                                     â”‚
â”‚  async def batch_create_users_async(users_data, delay):          â”‚
â”‚                                                                   â”‚
â”‚      â±ï¸  Start: 10:00:00                                         â”‚
â”‚                                                                   â”‚
â”‚      ðŸ”„ User 1: Alice   âœ… Created (0.5s)                        â”‚
â”‚      â³ Wait 0.5s...                                             â”‚
â”‚                                                                   â”‚
â”‚      ðŸ”„ User 2: Bob     âœ… Created (0.5s)                        â”‚
â”‚      â³ Wait 0.5s...                                             â”‚
â”‚                                                                   â”‚
â”‚      ðŸ”„ User 3: Charlie âœ… Created (0.5s)                        â”‚
â”‚      â³ Wait 0.5s...                                             â”‚
â”‚                                                                   â”‚
â”‚      ðŸ”„ User 4: Diana   âœ… Created (0.5s)                        â”‚
â”‚      â³ Wait 0.5s...                                             â”‚
â”‚                                                                   â”‚
â”‚      ðŸ”„ User 5: Eve     âœ… Created (0.5s)                        â”‚
â”‚                                                                   â”‚
â”‚      â±ï¸  End: 10:00:02.5                                         â”‚
â”‚      â±ï¸  Duration: 2.5 seconds                                   â”‚
â”‚                                                                   â”‚
â”‚  âš ï¸  AGENT WAITS HERE AUTOMATICALLY! âš ï¸                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â”‚ Returns result
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       RESULT RETURNED                            â”‚
â”‚                                                                   â”‚
â”‚  {                                                                â”‚
â”‚    "status": "completed",                                        â”‚
â”‚    "total_requested": 5,                                         â”‚
â”‚    "successful": 5,                                              â”‚
â”‚    "failed": 0,                                                  â”‚
â”‚    "created_users": [                                            â”‚
â”‚      {"id": "...", "name": "Alice", ...},                        â”‚
â”‚      {"id": "...", "name": "Bob", ...},                          â”‚
â”‚      {"id": "...", "name": "Charlie", ...},                      â”‚
â”‚      {"id": "...", "name": "Diana", ...},                        â”‚
â”‚      {"id": "...", "name": "Eve", ...}                           â”‚
â”‚    ],                                                             â”‚
â”‚    "duration_seconds": 2.5,                                      â”‚
â”‚    "message": "Batch creation completed: 5 successful, 0 failed" â”‚
â”‚  }                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    AGENT PROCESSES RESULT                        â”‚
â”‚  - Receives the complete result                                  â”‚
â”‚  - Formats response for user                                     â”‚
â”‚  - Returns to user                                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                         â”‚
                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      USER GETS RESPONSE                          â”‚
â”‚                                                                   â”‚
â”‚  "I've successfully created 5 users using batch creation:        â”‚
â”‚   - Alice, Bob, Charlie, Diana, and Eve                          â”‚
â”‚   The operation took 2.5 seconds and all users were created      â”‚
â”‚   successfully."                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Key Points

### 1. Agent Waits Automatically âœ…
```
Agent invokes tool â†’ Tool runs (2.5s) â†’ Agent waits â†’ Tool returns â†’ Agent continues
                      â³ WAITING â³
```

### 2. No Special Code Needed
```python
# You just write:
@mcp.tool()
async def my_tool(data: str) -> dict:
    await asyncio.sleep(5)  # Do work
    return {"result": data}

# Agent automatically:
# 1. Calls the tool
# 2. Waits for it to complete
# 3. Gets the result
# 4. Continues
```

### 3. Multiple Tools Can Be Called
```
User Request â†’ Agent â†’ Tool 1 (wait) â†’ Tool 2 (wait) â†’ Tool 3 (wait) â†’ Response
                       â³ 2s          â³ 3s          â³ 1s
                       Total: 6 seconds
```

## Pattern Comparison

### Pattern 1: Synchronous
```
Agent â†’ Tool â†’ time.sleep(5) â†’ Return
        â³ Blocks thread for 5s
```

### Pattern 2: Async (RECOMMENDED)
```
Agent â†’ Tool â†’ await asyncio.sleep(5) â†’ Return
        â³ Non-blocking wait for 5s
        âœ… Other operations can run concurrently
```

### Pattern 3: Background Task
```
Agent â†’ start_task() â†’ Returns task_id immediately
        â†“
        Background: Processing... (5 minutes)
        â†“
Agent â†’ wait_for_task(task_id) â†’ Polls until complete â†’ Return
        â³ Waits for background task
```

### Pattern 4: Progressive
```
Agent â†’ Tool â†’ Step 1 (1s) â†’ Step 2 (1s) â†’ Step 3 (1s) â†’ Return all steps
        â³ Waits for all steps to complete
```

## Architecture Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        YOUR APPLICATION                       â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚              FastAPI Application                       â”‚  â”‚
â”‚  â”‚              (Port 8000)                               â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”‚
â”‚  â”‚  â”‚         PydanticAI Agent                         â”‚  â”‚  â”‚
â”‚  â”‚  â”‚                                                   â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Receives user requests                        â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Invokes MCP tools                             â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Waits for completion                          â”‚  â”‚  â”‚
â”‚  â”‚  â”‚  - Returns results                               â”‚  â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â”‚
â”‚  â”‚                 â”‚                                       â”‚  â”‚
â”‚  â”‚                 â”‚ MCP Client (SSE)                      â”‚  â”‚
â”‚  â”‚                 â”‚                                       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                    â”‚                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ HTTP SSE Connection
                     â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   MCP SERVER                                  â”‚
â”‚                   (Port 8001)                                 â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  FastMCP Server                                         â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  Tools:                                                  â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ @mcp.tool()                                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ def create_user(...)                               â”‚ â”‚ â”‚
â”‚  â”‚  â”‚     return user                                    â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ @mcp.tool()                                        â”‚ â”‚ â”‚
â”‚  â”‚  â”‚ async def batch_create_users_async(...)            â”‚ â”‚ â”‚
â”‚  â”‚  â”‚     for user in users:                             â”‚ â”‚ â”‚
â”‚  â”‚  â”‚         await asyncio.sleep(0.5)  # Rate limit     â”‚ â”‚ â”‚
â”‚  â”‚  â”‚         create_user(user)                          â”‚ â”‚ â”‚
â”‚  â”‚  â”‚     return results                                 â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â”‚                                                          â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚ â”‚
â”‚  â”‚  â”‚ Other tools: read, update, delete, list...         â”‚ â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  In-Memory Database                                     â”‚ â”‚
â”‚  â”‚  users_db: Dict[str, dict] = {}                         â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Sequence Diagram: Async Tool Execution

```
User          Agent         MCP Server      Tool              Database
 â”‚              â”‚                â”‚            â”‚                   â”‚
 â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                â”‚            â”‚                   â”‚
 â”‚ "Create      â”‚                â”‚            â”‚                   â”‚
 â”‚  5 users"    â”‚                â”‚            â”‚                   â”‚
 â”‚              â”‚                â”‚            â”‚                   â”‚
 â”‚              â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚            â”‚                   â”‚
 â”‚              â”‚ Call tool      â”‚            â”‚                   â”‚
 â”‚              â”‚                â”‚            â”‚                   â”‚
 â”‚              â”‚                â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚                   â”‚
 â”‚              â”‚                â”‚ Execute    â”‚                   â”‚
 â”‚              â”‚                â”‚            â”‚                   â”‚
 â”‚              â”‚                â”‚            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚              â”‚                â”‚            â”‚ Create User 1     â”‚
 â”‚              â”‚                â”‚            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚              â”‚                â”‚            â”‚ User 1 created    â”‚
 â”‚              â”‚                â”‚            â”‚                   â”‚
 â”‚              â”‚                â”‚            â”‚ await sleep(0.5s) â”‚
 â”‚              â”‚                â”‚            â”‚ â³                â”‚
 â”‚              â”‚                â”‚            â”‚                   â”‚
 â”‚              â”‚                â”‚            â”‚â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€>â”‚
 â”‚              â”‚                â”‚            â”‚ Create User 2     â”‚
 â”‚              â”‚                â”‚            â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
 â”‚              â”‚                â”‚            â”‚ User 2 created    â”‚
 â”‚              â”‚                â”‚            â”‚                   â”‚
 â”‚              â”‚                â”‚            â”‚ await sleep(0.5s) â”‚
 â”‚              â”‚                â”‚            â”‚ â³                â”‚
 â”‚              â”‚                â”‚            â”‚                   â”‚
 â”‚              â”‚                â”‚            â”‚ ... (repeat for   â”‚
 â”‚              â”‚                â”‚            â”‚      all users)   â”‚
 â”‚              â”‚                â”‚            â”‚                   â”‚
 â”‚              â”‚                â”‚            â”‚ Build result dict â”‚
 â”‚              â”‚                â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                   â”‚
 â”‚              â”‚                â”‚ Return     â”‚                   â”‚
 â”‚              â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ result     â”‚                   â”‚
 â”‚              â”‚                â”‚            â”‚                   â”‚
 â”‚              â”‚ Format responseâ”‚            â”‚                   â”‚
 â”‚<â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                â”‚            â”‚                   â”‚
 â”‚ "Successfullyâ”‚                â”‚            â”‚                   â”‚
 â”‚  created 5   â”‚                â”‚            â”‚                   â”‚
 â”‚  users"      â”‚                â”‚            â”‚                   â”‚
 â”‚              â”‚                â”‚            â”‚                   â”‚

Total time: ~2.5 seconds (5 users Ã— 0.5s delay)
Agent waits the entire time! âœ…
```

## Summary

**The key insight:** You don't need to do anything special! Just:

1. Write your tool (sync or async)
2. Do the work
3. Return the result
4. **The agent automatically waits!** âœ…

That's it! ðŸŽ‰
